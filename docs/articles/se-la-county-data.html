<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproducing LA County Standard Errors from [@buja2019modelsasapproximationspart1] • maars</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproducing LA County Standard Errors from [@buja2019modelsasapproximationspart1]">
<meta property="og:description" content="maars">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">maars</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/se-la-county-data.html">Reproducing Buja et. al. Tables</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shamindras/maars/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="se-la-county-data_files/header-attrs-2.7/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reproducing LA County Standard Errors from <span class="citation">(Buja et al. 2019)</span>
</h1>
                        <h4 class="author">Riccardo Fogliato, Shamindra Shrotriya</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/shamindras/maars/blob/master/vignettes/se-la-county-data.Rmd"><code>vignettes/se-la-county-data.Rmd</code></a></small>
      <div class="hidden name"><code>se-la-county-data.Rmd</code></div>

    </div>

    
    
<div id="setup-and-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#setup-and-installation" class="anchor"></a>Setup and Installation</h2>
<p>First, we’ll load the <code>maars</code> package, and other <code>tidyverse</code> analysis packages. If you are a new user, you will need to manually run the following commands in a new in an <code>R</code> session before running the vignette code below:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span>pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tidyverse"</span>, <span class="st">"vroom"</span>, <span class="st">"glue"</span>, <span class="st">"magrittr"</span>, 
                          <span class="st">"knitr"</span>, <span class="st">"kableExtra"</span>, <span class="st">"remotes"</span>, <span class="st">"magick"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">'shamindras/maars'</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>We will explicitly load the <code>tidyverse</code> set of packages to get access to the <code>magrittr</code> pipe (<code><a href="../reference/%&gt;%.html">%&gt;%</a></code>) operator. We will also set a global random seed for reproducibility purposes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">25422267</span><span class="op">)</span></code></pre></div>
<p>For all other functions we will refer to them explicitly using the <code>package::function</code> reference method to avoid ambiguity in the source package of the specific function used (to avoid function name conflicts).</p>
</div>
<div id="goal-of-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#goal-of-analysis" class="anchor"></a>Goal of Analysis</h2>
<p>We try to replicate the results of Table 1 in <span class="citation">(Buja et al. 2019)</span>, as shown below:</p>
</div>
<div id="loading-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-data" class="anchor"></a>Loading the data</h2>
<p>Let’s load the LA County Homeless persons data as used in <span class="citation">(Buja et al. 2019)</span> and briefly examine it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># LA County source data url, use glue to split string in easy to read format</span>
<span class="va">url_la_county_dat</span> <span class="op">&lt;-</span> <span class="fu">glue</span><span class="fu">::</span><span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html">glue</a></span><span class="op">(</span><span class="st">"http://www-stat.wharton.upenn.edu/~buja"</span>,
                                <span class="st">"STAT-961/Homeless_LA_by_Census_Tracts.csv"</span>,
                                .sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>

<span class="va">la_county_df</span> <span class="op">&lt;-</span> <span class="fu">vroom</span><span class="fu">::</span><span class="fu"><a href="https://vroom.r-lib.org/reference/vroom.html">vroom</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">url_la_county_dat</span><span class="op">)</span> <span class="co"># %&gt;% dplyr::rename("MedianInc1000" = "MedianInc ($1000)")</span>
<span class="va">la_county_df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<p>Let’s view the first few rows to understand the structure of the data frame.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">la_county_df</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span></code></pre></div>
<p>It is already in tidy format <span class="citation">(Wickham 2014)</span>. So we have imported the data correctly, given that we match the column names in Table 1 of the <span class="citation">(Buja et al. 2019)</span> paper.</p>
</div>
<div id="fitting-the-ols-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-ols-model" class="anchor"></a>Fitting the OLS model</h2>
<p>We now fit an linear model of the count of homeless people (<code>StreetTotal</code>) as the response variable, against the other covariates using Ordinary Least Squares (OLS).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_fit</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">StreetTotal</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">la_county_df</span><span class="op">)</span></code></pre></div>
</div>
<div id="computing-standard-errors-from-ols-assuming-well-specification" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-standard-errors-from-ols-assuming-well-specification" class="anchor"></a>Computing standard errors from OLS (Assuming Well Specification)</h2>
<p>Let’s first obtain the standard errors for the fitted coefficients returned from the <code>lm</code> object. We can do this in a tidy manner using the <code><a href="https://generics.r-lib.org/reference/tidy.html">broom::tidy</a></code> function applied to our fitted <code>lm</code> object, and selecting only the required columns.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se_lm</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">mod_fit</span><span class="op">)</span> <span class="op">%&gt;%</span> 
          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">std.error</span><span class="op">)</span> <span class="op">%&gt;%</span> 
          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">.</span>, std.error.lm <span class="op">=</span> <span class="va">std.error</span><span class="op">)</span>
<span class="va">se_lm</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, 
                   nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Term'</span>, <span class="st">'$SE_{\\text{lin}}$'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">2</span>, 
               align <span class="op">=</span> <span class="st">"c"</span>, escape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span></code></pre></div>
</div>
<div id="computing-standard-errors-from-ols-using-empirical-bootstrap" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-standard-errors-from-ols-using-empirical-bootstrap" class="anchor"></a>Computing standard errors from OLS using Empirical Bootstrap</h2>
<p>We now compute the standard errors via <span class="math inline">\(B = 10^{3}\)</span> bootstrap replications of the dataset of the same size as the original dataset i.e. of the <span class="math inline">\(B\)</span> replications samples with replacement <span class="math inline">\(n = 505\)</span> observations from the entire data (which contains <span class="math inline">\(n = 505\)</span> observations).</p>
<p>Let’s first get the OLS estimates.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_emp_boot</span> <span class="op">&lt;-</span> <span class="fu">maars</span><span class="fu">::</span><span class="fu">comp_empirical_bootstrap</span><span class="op">(</span>mod_fit <span class="op">=</span> <span class="va">mod_fit</span>, B <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">coef_emp_boot</span><span class="op">)</span></code></pre></div>
<p>We can visualize the distribution of the variance to check whether it well approximates the normal distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qnorm_boot</span> <span class="op">&lt;-</span> <span class="fu">maars</span><span class="fu">::</span><span class="fu">qqnorm_bootstrap</span><span class="op">(</span><span class="va">coef_emp_boot</span><span class="op">)</span>
<span class="va">qnorm_boot</span></code></pre></div>
<p>The distribution of the OLS coefficients estimates appears to be approximately normal. Thanks to the fairly large sample size, we can assume to be in the asymptotic regime.</p>
<p>Let’s now compute the standard errors from the outcome of the bootstrap. This can be done through the following function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se_emp</span> <span class="op">&lt;-</span> <span class="fu">maars</span><span class="fu">::</span><span class="fu">comp_bootstrap_summary</span><span class="op">(</span>mod_fit <span class="op">=</span> <span class="va">mod_fit</span>, 
                                       boot_out <span class="op">=</span> <span class="va">coef_emp_boot</span>, 
                                       boot_type <span class="op">=</span> <span class="st">'emp'</span><span class="op">)</span> <span class="op">%&gt;%</span>
            <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">std.error</span>, <span class="op">-</span><span class="va">statistic</span>, <span class="op">-</span><span class="va">p.value</span><span class="op">)</span></code></pre></div>
<p>This now fits, the <span class="math inline">\(B = 10^{3}\)</span> replications. let’s view the output.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se_emp</span> <span class="op">%&gt;%</span> 
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, 
                   nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Term'</span>, <span class="st">'$\\widehat{\\beta}_{j}$'</span>,
                          <span class="st">'$SE_{\\text{boot}}$'</span>, <span class="st">'$t_{\\text{boot}}$'</span>,
                          <span class="st">'$p_{\\text{boot}}$'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">2</span>, 
               align <span class="op">=</span> <span class="st">"c"</span>, escape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span></code></pre></div>
<p>As we can see, the output is in tidy format as a <code>tibble</code> object. This makes it much more readily amenable for additional transformations using the <code>tidyverse</code> set of packages.</p>
<p>Last, let’s compute the confidence intervals for the coefficients estimated on the bootstrapped data sets via the percentile method.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_emp_boot</span> <span class="op">%&gt;%</span> 
  <span class="fu">maars</span><span class="fu">::</span><span class="fu">comp_conf_int_bootstrap</span><span class="op">(</span>probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">q</span>, values_from <span class="op">=</span> <span class="va">x</span><span class="op">)</span></code></pre></div>
</div>
<div id="computing-standard-errors-from-ols-using-multiplier-bootstrap" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-standard-errors-from-ols-using-multiplier-bootstrap" class="anchor"></a>Computing standard errors from OLS using Multiplier Bootstrap</h2>
<p>We now compute the standard errors via <span class="math inline">\(B = 10^{3}\)</span> multiplier bootstrap replications. This can be done through the following function.</p>
<p>Let’s first get the OLS estimates.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_mult_boot</span> <span class="op">&lt;-</span> <span class="fu">maars</span><span class="fu">::</span><span class="fu">comp_multiplier_bootstrap_var</span><span class="op">(</span>mod_fit <span class="op">=</span> <span class="va">mod_fit</span>, 
                                                      B <span class="op">=</span> <span class="fl">1000</span>, 
                                                      weights_type <span class="op">=</span> <span class="st">"std_gaussian"</span><span class="op">)</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">coef_mult_boot</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># se_mult &lt;- maars::comp_bootstrap_summary(mod_fit = mod_fit, </span>
<span class="co">#                                        boot_out = coef_mult_boot, </span>
<span class="co">#                                        boot_type = 'mult') %&gt;%</span>
<span class="co">#             dplyr::select(-std.error, -statistic, -p.value)</span></code></pre></div>
</div>
<div id="computing-standard-errors-from-ols-using-sandwich-estimator" class="section level2">
<h2 class="hasAnchor">
<a href="#computing-standard-errors-from-ols-using-sandwich-estimator" class="anchor"></a>Computing standard errors from OLS using Sandwich Estimator</h2>
<p>Then we obtain the standard errors using the White sandwich estimator see <span class="citation">White (1980b)</span>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se_sand</span> <span class="op">&lt;-</span> <span class="fu">maars</span><span class="fu">::</span><span class="fu">comp_sandwich_qr_var</span><span class="op">(</span>mod_fit <span class="op">=</span> <span class="va">mod_fit</span><span class="op">)</span>
<span class="va">se_sand</span></code></pre></div>
<p>We can also visually compare the two types of confidence intervals.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">comp_se</span> <span class="op">&lt;-</span> <span class="va">se_sand</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>, <span class="va">std.error.sand</span>, <span class="va">std.error</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">!=</span> <span class="st">'(Intercept)'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span><span class="op">(</span><span class="va">se_emp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">std.error.boot.emp</span><span class="op">)</span>, 
                    by <span class="op">=</span> <span class="st">'term'</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">std.error</span>, <span class="va">std.error.sand</span>, <span class="va">std.error.boot.emp</span><span class="op">)</span>,
                      names_to <span class="op">=</span> <span class="st">'Type'</span>, 
                      values_to <span class="op">=</span> <span class="st">'std.error'</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span>
                          <span class="va">Type</span> <span class="op">==</span> <span class="st">"std.error"</span> <span class="op">~</span> <span class="st">"lm"</span>,
                          <span class="va">Type</span> <span class="op">==</span> <span class="st">"std.error.sand"</span> <span class="op">~</span> <span class="st">"sandwich"</span>,
                          <span class="va">Type</span> <span class="op">==</span> <span class="st">"std.error.boot.emp"</span> <span class="op">~</span> <span class="st">"emp.boot."</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Type <span class="op">=</span> 
                  <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a></span><span class="op">(</span><span class="va">Type</span>, 
                                       <span class="st">"lm"</span>, <span class="st">"sandwich"</span>, <span class="st">"emp.boot."</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">term</span>, <span class="va">estimate</span>, col <span class="op">=</span> <span class="va">Type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Regressor'</span>, y <span class="op">=</span> <span class="st">'Estimate'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, 
                                                              mean <span class="op">=</span> <span class="fl">0</span>, 
                                                              sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">std.error</span>, 
                                      ymax <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.975</span>, 
                                                              mean <span class="op">=</span> <span class="fl">0</span>, 
                                                              sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">std.error</span><span class="op">)</span>,
                         position <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>, 
                         width <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>col<span class="op">=</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"Type of standard errors"</span><span class="op">)</span><span class="op">)</span>
<span class="va">comp_se</span></code></pre></div>
</div>
<div id="comparing-standard-errors" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-standard-errors" class="anchor"></a>Comparing standard errors</h2>
<p>We combine the standard errors into one tibble.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se_comb</span> <span class="op">&lt;-</span> <span class="va">se_sand</span> <span class="op">%&gt;%</span> 
      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, 
                       y <span class="op">=</span> <span class="va">se_emp</span> <span class="op">%&gt;%</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">estimate</span><span class="op">)</span>, 
                       by <span class="op">=</span> <span class="st">"term"</span><span class="op">)</span>

<span class="va">se_comb</span> <span class="op">%&gt;%</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html">set_names</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, 
                   nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Term'</span>, <span class="st">'$\\widehat{\\beta}_{j}$'</span>, 
                          <span class="st">'$SE_{\\text{lin}}$'</span>,
                          <span class="st">'$t_{\\text{lin}}$'</span>,
                          <span class="st">'$p_{\\text{lin}}$'</span>,
                          <span class="st">'$SE_{\\text{sand}}$'</span>, 
                          <span class="st">'$t_{\\text{sand}}$'</span>,
                          <span class="st">'$p_{\\text{sand}}$'</span>,
                          <span class="st">'$SE_{\\text{boot}}$'</span>,
                          <span class="st">'$t_{\\text{boot}}$'</span>,
                          <span class="st">'$p_{\\text{boot}}$'</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">2</span>, 
               align <span class="op">=</span> <span class="st">"c"</span>, escape <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span></code></pre></div>
</div>
<div id="reproduce-table-1-from-buja2019modelsasapproximationspart1" class="section level2">
<h2 class="hasAnchor">
<a href="#reproduce-table-1-from-buja2019modelsasapproximationspart1" class="anchor"></a>Reproduce Table 1 from <span class="citation">(Buja et al. 2019)</span>
</h2>
<p>We can also compute the ratios of the standard errors and the t-statistics as in Table 1 from <span class="citation">(Buja et al. 2019)</span>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># t_stats &lt;- se_comb %&gt;%</span>
<span class="co">#             dplyr::mutate(</span>
<span class="co">#               rat.boot.vs.lm = std.error.boot / std.error.lm,</span>
<span class="co">#               rat.sand.vs.lm = std.error.sand / std.error.lm,</span>
<span class="co">#               rat.sand.vs.boot = std.error.sand / std.error.boot,</span>
<span class="co">#               t.lm = estimate / std.error.lm,</span>
<span class="co">#               t.boot = estimate / std.error.boot,</span>
<span class="co">#               t.sand = estimate / std.error.sand</span>
<span class="co">#             )</span>
<span class="co"># t_stats %&gt;%</span>
<span class="co">#   purrr::set_names(x = ., </span>
<span class="co">#                    nm = c("Term", '$\\widehat{\\beta}_{j}$', </span>
<span class="co">#                           '$SE_{\\text{lin}}$', '$SE_{\\text{boot}}$',</span>
<span class="co">#                           '$SE_{\\text{sand}}$',</span>
<span class="co">#                           "$\\frac{SE_{\\text{boot}}}{SE_{\\text{lin}}}$",</span>
<span class="co">#                           "$\\frac{SE_{\\text{sand}}}{SE_{\\text{lin}}}$", </span>
<span class="co">#                           "$\\frac{SE_{\\text{sand}}}{SE_{\\text{boot}}}$",</span>
<span class="co">#                           "$t_{\\text{lin}}$", "$t_{\\text{boot}}$", </span>
<span class="co">#                           "$t_{\\text{sand}}$")) %&gt;%</span>
<span class="co">#   knitr::kable(x = ., format = "html", digits = 2, </span>
<span class="co">#                align = "c", escape = TRUE) %&gt;% </span>
<span class="co">#   kableExtra::kable_styling(position = "center")</span></code></pre></div>
</div>
<div id="model-diagnostics-from-buja2019modelsasapproximationspart1" class="section level2">
<h2 class="hasAnchor">
<a href="#model-diagnostics-from-buja2019modelsasapproximationspart1" class="anchor"></a>Model diagnostics from <span class="citation">(Buja et al. 2019)</span>
</h2>
<p>When the model is misspecified, regression coefficients should be seen as statistical functionals rather than fixed quantities. These parameters depend on the distribution of the regressors and it is therefore important to study across the regions of the parameter space.</p>
<p>Let’s then first get OLS estimates under the default reweighting schema implemented in the <code>maars</code> package.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">coef_rwgt</span> <span class="op">&lt;-</span> <span class="va">mod_fit</span> <span class="op">%&gt;%</span> 
  <span class="fu">maars</span><span class="fu">::</span><span class="fu">comp_coef_rwgt</span><span class="op">(</span>mod_fit <span class="op">=</span> <span class="va">.</span>,
                 terms_to_rwgt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">la_county_df</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
                 B <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>
<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">coef_rwgt</span><span class="op">)</span></code></pre></div>
<p>To facilitate the interpretation of the results, we rely on graphical model diagnostics. Here, we show the “focal slope” model diagnostics. The <code>focal_slope</code> plot shows how one coefficient of interests varies under reweighting of each of the regressors. In the plot below we consider the case of “PercVacant.”</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu">maars</span><span class="fu">::</span><span class="fu">focal_slope</span><span class="op">(</span><span class="va">mod_fit</span>, <span class="va">coef_rwgt</span>, <span class="st">'PercVacant'</span><span class="op">)</span>
<span class="va">fs</span></code></pre></div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-buja2019modelsasapproximationspart1" class="csl-entry">
Buja, Andreas, Lawrence Brown, Richard Berk, Edward George, Emil Pitkin, Mikhail Traskin, Kai Zhang, and Linda Zhao. 2019. <span>“Models as Approximations <span>I</span>: Consequences Illustrated with Linear Regression.”</span> <em>Statist. Sci.</em> 34 (4): 523–44. <a href="https://doi.org/10.1214/18-STS693">https://doi.org/10.1214/18-STS693</a>.
</div>
<div id="ref-white1980heteroskedasticconsistentcovest" class="csl-entry">
White, Halbert. 1980a. <span>“A Heteroskedasticity-Consistent Covariance Matrix Estimator and a Direct Test for Heteroskedasticity.”</span> <em>Econometrica</em> 48 (4): 817–38. <a href="https://doi.org/10.2307/1912934">https://doi.org/10.2307/1912934</a>.
</div>
<div id="ref-white1980usinglsapproxunknownregfuncs" class="csl-entry">
———. 1980b. <span>“Using Least Squares to Approximate Unknown Regression Functions.”</span> <em>Internat. Econom. Rev.</em> 21 (1): 149–70. <a href="https://doi.org/10.2307/2526245">https://doi.org/10.2307/2526245</a>.
</div>
<div id="ref-wickham2014tidydata" class="csl-entry">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of Statistical Software</em> 59 (10). <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shamindra Shrotriya, Riccardo Fogliato.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
